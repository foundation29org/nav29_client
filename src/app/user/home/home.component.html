<div *ngIf="!loadedDocs">
    <div class="pt-4 mx-auto center-elements" style="max-width: 40rem !important;">
        <em class="fa fa-spinner fa-spin fa-3x fa-fw primary"></em>
    </div>
</div>
<ng-container *ngIf="loadedDocs">
    <!-- Menú de navegación solo para pantallas pequeñas -->
    <div *ngIf="isSmallScreen()"
    class="navigation-menu border-bottom d-flex justify-content-center align-items-center py-2 w-100">
    <div class="btn-group w-100 px-2" role="group">
        <!-- view documents-->
        <button *ngIf="role != 'Caregiver'" class="btn btn-dark flex-grow-1"
            [ngClass]="{'active-view': currentView === 'documents'}"
            (click)="setView('documents')" title="{{'topnavbar.Reports' | translate}}">
            <i class="fa fa-file-text"></i>
            <span class="ml-2" *ngIf="!isXSScreen()">{{'topnavbar.Reports' | translate }}</span>
        </button>
        <button class="btn btn-dark flex-grow-1"
            [ngClass]="{'active-view': currentView === 'chat'}"
            (click)="setView('chat')" title="{{'home.s1.2' | translate}}">
            <i class="fa-kit fa-ai"></i>
            <span class="ml-2" *ngIf="!isXSScreen()">{{'home.s1.2' | translate}}</span>
        </button>
        <button id="notes-title" class="btn btn-dark flex-grow-1"
            [ngClass]="{'active-view': currentView === 'notes'}"
            (click)="setView('notes')" title="{{'summaryoptions.title' | translate}}">
            <i class="fa fa-sticky-note"></i>
            <span class="ml-2" *ngIf="!isXSScreen()">{{'summaryoptions.title' | translate}}</span>
        </button>
        <button class="btn btn-dark flex-grow-1" id="diary-title"
            [ngClass]="{'active-view': currentView === 'diary'}"
            (click)="setView('diary')" title="{{'diary.title' | translate}}">
            <i class="fa fa-comments"></i>
            <span class="ml-2" *ngIf="!isXSScreen()">{{'diary.title' | translate}}</span>
        </button>
        <button class="btn btn-dark flex-grow-1" id="dxgpt-title"
            [ngClass]="{'active-view': currentView === 'dxgpt'}"
            (click)="setView('dxgpt')" title="{{'dxgpt.button' | translate}}">
            <i class="fa fa-stethoscope"></i>
            <span class="ml-2" *ngIf="!isXSScreen()">{{'dxgpt.button' | translate}}</span>
        </button>
    </div>
</div>
    <div class="main-container-user pb-4">
        <div *ngIf="isSmallScreen() && currentView === 'chat' && messages.length > 0"
            class="fixed-buttons-container p-0 pt-1 pb-1 border-bottom d-flex justify-content-between align-items-center"
            style="background-color: #f0f0f0;">
            <div class="flex-grow-1 d-flex justify-content-center">
                <div class="" style="z-index: 0;">
                    <button class="btn btn-white" (click)="deleteChat()"
                        [attr.title]="isStepInProcess() ? ('generics.Please wait' | translate) : ('home.s1.2.1' | translate)"
                        [disabled]="isStepInProcess()">
                        <em class="fa fa-plus mr-1"></em> {{'home.s1.2.1' | translate }}
                    </button>
                </div>
            </div>
        </div>
        <div *ngIf="!isSmallScreen()"
            class="fixed-buttons-container border-bottom d-flex justify-content-between align-items-center" [ngClass]="{'left300': currentView === 'chat' && role != 'Caregiver'}" style="background-color: #fff;">
            <div class="flex-grow-1 d-flex justify-content-center remove-background">
                <!-- Chat Button -->
                <button class="btn btn-dark mx-2"
                    [ngClass]="{'active-view': currentView === 'chat'}"
                    (click)="setView('chat')">
                    <i class="fa-kit fa-ai"></i>
                    <span class="ml-2">{{'home.s1.2' | translate}}</span>
                </button>
                <!-- Notes Button -->
                <button  class="btn btn-dark mx-2"
                    [ngClass]="{'active-view': currentView === 'notes'}"
                    (click)="setView('notes')">
                    <i class="fa fa-sticky-note"></i>
                    <span id="notes-title" class="ml-2">{{'summaryoptions.title' | translate}}</span>
                </button>
                <!-- Diary Button -->
                <button class="btn btn-dark mx-2" 
                    [ngClass]="{'active-view': currentView === 'diary'}"
                    (click)="setView('diary')">
                    <i class="fa fa-comments"></i>
                    <span id="diary-title" class="ml-2">{{'diary.title' | translate}}</span>
                </button>
                <!-- DxGPT Button -->
                <button class="btn btn-dark mx-2" 
                    [ngClass]="{'active-view': currentView === 'dxgpt'}"
                    (click)="setView('dxgpt')">
                    <i class="fa fa-stethoscope"></i>
                    <span id="dxgpt-title" class="ml-2">{{'dxgpt.button' | translate}}</span>
                </button>                
            </div>

            <!-- New Chat Button - Solo visible en la vista de chat cuando hay mensajes -->
            <div *ngIf="currentView === 'chat' && messages.length > 0" class="position-absolute" style="right: 1rem;">
                <button class="btn btn-white btn-sm" (click)="deleteChat()"
                    [attr.title]="isStepInProcess() ? ('generics.Please wait' | translate) : ('home.s1.2.1' | translate)"
                    [disabled]="isStepInProcess()">
                    <em class="fa fa-plus mr-1"></em> {{'home.s1.2.1' | translate }}
                </button>
            </div>
        </div>

        <div *ngIf="currentView != 'diary' && currentView != 'notes' && currentView != 'dxgpt' && role != 'Caregiver'" class="sidebar border-right"
            [ngClass]="{'open': sidebarOpen || !isSmallScreen()}">
            <div class="sidebar-content" id="sidebar-content">
                <!-- Header -->
                <div class="sidebar-header pb-0">
                    <h3 class="font-medium-3">{{'topnavbar.Reports' | translate }}
                        <button type="button" class="ml-1 btn botonAddDoc btn-dark"
                            (click)="openOptionsFiles(contentviewSelectFile)" title="{{'generics.Add' | translate }}">
                            <i class="white fa fa-plus"></i>
                        </button>
                    </h3>
                    <!--<button class="sidebar-close" (click)="toggleSidebar()" *ngIf="isSmallScreen()"
                        title="{{'generics.Close' | translate }}">
                        <i class="fa fa-times"></i>
                    </button>-->
                </div>

                <!-- Main Content -->
                <div class="sidebar-main">
                    <div *ngIf="docs.length > 0" class="pb-3">
                        <div *ngIf="docs.length > 7" class="mb-3">
                            <div class="input-group mb-2">
                                <input type="text" class="form-control mt-0 filter-input" [(ngModel)]="searchTerm"
                                    (input)="searchDocs()" placeholder="{{'reportsSection.Filter' | translate }}">
                            </div>
                            <small class="d-block mb-1"><strong>{{'generics.Sort' | translate }}:</strong></small>
                            <div class="d-flex justify-content-between align-items-center">

                                <div>
                                    <button class="btn btn-sm btn-light bg-grey bg-lighten-4 mr-1"
                                        (click)="sortDocs('title')" [ngClass]="{'active': sortKey == 'title'}">
                                        {{'generics.Name' | translate }}
                                        <i *ngIf="sortKey == 'title'"
                                            [ngClass]="(sortDirection == '1') ? 'fa fa-arrow-up' : 'fa fa-arrow-down'"></i>
                                    </button>
                                    <button class="btn btn-sm btn-light bg-grey bg-lighten-4 mr-1"
                                        (click)="sortDocs('categoryTag')"
                                        [ngClass]="{'active': sortKey == 'categoryTag'}">
                                        {{'reportsSection.Type' | translate }}
                                        <i *ngIf="sortKey == 'categoryTag'"
                                            [ngClass]="(sortDirection == '-1') ? 'fa fa-arrow-up' : 'fa fa-arrow-down'"></i>
                                    </button>
                                    <button class="btn btn-sm btn-light bg-grey bg-lighten-4"
                                        (click)="sortDocs('originaldate')"
                                        [ngClass]="{'active': sortKey == 'originaldate'}">
                                        {{'generics.Date' | translate }}
                                        <i *ngIf="sortKey == 'originaldate'"
                                            [ngClass]="(sortDirection == '-1') ? 'fa fa-arrow-up' : 'fa fa-arrow-down'"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="select-all">
                            <input type="checkbox" [(ngModel)]="selectAllDocuments" (change)="toggleAllDocuments()"
                                [checked]="true">
                            <span class="ml-1">{{'generics.Select all documents' | translate }}</span>
                        </div>
                        <hr class="mt-0 mb-0">
                        <ul class="document-list">
                            <li *ngFor="let doc of filteredDocs" class="mt-3">
                                <input
                                    *ngIf="doc.status == 'finished' || doc.status == 'done' || doc.status == 'resumen ready'"
                                    type="checkbox" [(ngModel)]="doc.selected" class="mr-1"
                                    (change)="updateDocumentSelection()" [checked]="true">
                                <span class="mr-1"
                                    *ngIf="doc.status != 'finished' && doc.status != 'done' && doc.status != 'resumen ready'">
                                    <em *ngIf="doc.status == 'pending' || doc.status == ''" class="fa fa-clock-o"></em>
                                    <em *ngIf="doc.status == 'inProcess' || doc.status == 'creando resumen' || doc.status == 'extracted_translated done' || doc.status == 'extracted done'"
                                        class="fa fa-spinner primary fa-spin"></em>
                                    <em *ngIf="doc.status == 'finished' || doc.status == 'done' || doc.status == 'resumen ready'"
                                        class="success fa fa-check"></em>
                                    <em *ngIf="doc.status == 'failed'" class="danger fa-solid fa-file-exclamation"
                                        title="{{'generics.A file has failed and needs to be deleted' | translate }}"></em>
                                </span>
                                <ng-container
                                    *ngIf="doc.status == 'finished' || doc.status == 'done' || doc.status == 'resumen ready'; else regularTitle">
                                    <a href="javascript:void(0)" class="document-link"
                                        (click)="openResults(doc, contentSummaryDoc)" [disabled]="openingResults"
                                        [title]="doc.title">
                                        {{truncateTitle(doc.title)}}
                                    </a>
                                </ng-container>
                                <ng-template #regularTitle>
                                    <span class="document-title" [title]="doc.title">{{truncateTitle(doc.title)}}</span>
                                </ng-template>
                                <span *ngIf="doc.status == 'failed' && doc.isOwner">
                                    <span [disabled]="openingResults" (click)="deleteDoc(doc)" class="ml-1 pointer"
                                        href="javascript:void(0)" title="{{'generics.Delete' | translate }}"><em
                                            class="fa fa-trash primary"></em></span>
                                </span>
                                <!--<span *ngIf="doc.feedback" class="d-inline-block"> <ngb-rating [rate]="doc.feedback.pregunta1" [readonly]="true" max="5" class="d-block pl-0 my-rating col-sm-5 col-xl-4"></ngb-rating></span>-->
                                <span class="d-block document-date"
                                    *ngIf="!isDateMissing(doc.originaldate); else missingDate">
                                    {{ doc.originaldate | date: 'longDate' }}
                                </span>
                                <ng-template #missingDate>
                                    <span class="d-block text-warning pointer d-flex align-items-center"
                                        (click)="openUpdateDocDate(doc, PanelChangeDate)"
                                        title="{{ 'dashboardpatient.Update document date' | translate }}">
                                        <em class="fa fa-exclamation-triangle mr-1"></em>
                                        <span>{{ 'generics.Missing date' | translate }}</span>
                                        <em class="fa fa-edit ml-1"></em>
                                    </span>
                                </ng-template>
                                <span class="d-block mt-1" *ngIf="doc.categoryTag">
                                    <span [ngClass]="doc.badge" class="badge">
                                        {{doc.categoryTag}}
                                    </span>
                                </span>
                            </li>
                        </ul>
                    </div>
                </div>

                <!-- Footer -->
                <div class="sidebar-footer">
                    <div class="d-flex justify-content-between align-items-center mb-3" *ngIf="loadedAllEvents">
                        <div class="btn-sm">
                            <span class="font-weight-bold">{{allEvents.length}}</span> {{'events.title' | translate }}
                        </div>
                        <button routerLink="/events" class="btn btn-sm btn-white">
                            {{'generics.View' | translate }}
                        </button>
                    </div>

                    <button class="btn btn-white btn-block btn-sm" (click)="openTimelineModal(timelineModal)"
                        *ngIf="timeline.length > 0">
                        <span>{{'timeline.Timeline' | translate }}</span>
                        <span class="ml-1 badge badge-dark">{{timeline.length}}</span>
                    </button>
                </div>
            </div>
        </div>
        <div class="content" *ngIf="currentView === 'chat'" [ngClass]="{'mleft300': role != 'Caregiver', 'mt-1': isSmallScreen() && messages.length == 0}">
            <ng-container>
                <div class="mt-2 mx-auto" style="max-width: 60rem !important;">
                    <ng-container *ngIf="messages.length < 1" class="main-chat-container">
                        <div class="row center-elements">
                            <div class="col-md-12">
                                <img class="logo-img-big" style="width: 160px;" src='assets/img/logo-lg-white.png' />
                            </div>
                            <div class="col-md-12 mb-2 mt-3">
                                <p>{{'optionsMenu.t1' | translate }}
                                    <a class="d-none text-decoration center-elements"
                                        (click)="startTutorial()"><ins>Tutorial</ins></a>
                                </p>
                                <p>{{'optionsMenu.t2' | translate }} <em class="primary" style="cursor: pointer;"
                                        placement="end-start" #p1="ngbPopover" [ngbPopover]="popContenthelp"
                                        popoverTitle="{{'topnavbar.Help' | translate }}">{{'optionsMenu.t3' | translate
                                        }}</em> {{'optionsMenu.t4' | translate }}</p>
                                <ng-template #popContenthelp>
                                    <span [innerHTML]="welcomeMsg | safe: 'html'">
                                    </span>
                                    <button class="pull-right mt-2" style="margin-top: 1em;margin-bottom: 1em;"
                                        (click)="p1.close()">{{'generics.Close' | translate }}</button>
                                </ng-template>
                            </div>
                            <div class="col-md-12 mb-2 mt-2 d-block" *ngIf="actualCategory == null">
                                <div class="border bg-grey bg-lighten-3 p-3">
                                    <a class="mr-1"
                                        [ngClass]="(showOptionsData == 'general') ? 'text-bold-700 border-custom' : ''"
                                        (click)="changeOptionData('general')">{{'optionsMenu.t5' | translate }}</a>
                                    <a class="ml-1 mr-1"
                                        [ngClass]="(showOptionsData == 'categoriesPatients') ? 'text-bold-700 border-custom' : ''"
                                        (click)="changeOptionData('categoriesPatients')">{{'categoriesPatients.title' |
                                        translate }}</a>
                                    <a class="ml-1 mr-1"
                                        [ngClass]="(showOptionsData == 'categoriesCaregivers') ? 'text-bold-700 border-custom' : ''"
                                        (click)="changeOptionData('categoriesCaregivers')">{{'categoriesCaregivers.title'
                                        | translate }}</a>
                                    <a class="ml-1"
                                        [ngClass]="(showOptionsData == 'summaryTypes') ? 'text-bold-700 border-custom' : ''"
                                        (click)="changeOptionData('summaryTypes')">{{'summaryoptions.title' | translate
                                        }}</a>
                                </div>
                            </div>
                            <ng-container *ngIf="showOptionsData == 'general'">
                                <div class="col-md-12">
                                    <div class="row">
                                        <div class="col-md-4">
                                            <div class="card card-body card-custom d-flex justify-content-center align-items-center pointer"
                                                (click)="selectCustomSuggestion('optionsMenu.q1')">
                                                {{'optionsMenu.q1' | translate }}
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="card card-body card-custom d-flex justify-content-center align-items-center pointer"
                                                (click)="selectCustomSuggestion('optionsMenu.q2')">
                                                {{'optionsMenu.q2' | translate }}
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="card card-body card-custom d-flex justify-content-center align-items-center pointer"
                                                (click)="selectCustomSuggestion('optionsMenu.q3')">
                                                {{'optionsMenu.q3' | translate }}
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="card card-body card-custom d-flex justify-content-center align-items-center pointer"
                                                (click)="selectCustomSuggestion('optionsMenu.q4')">
                                                {{'optionsMenu.q4' | translate }}
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div
                                                class="card card-body card-custom d-flex justify-content-center align-items-center">

                                                <li class="d-inline" ngbDropdown display="dynamic" placement="bottom">
                                                    <a class="position-relative colorlink" id="dropdownLang"
                                                        ngbDropdownToggle role="button">
                                                        <u>{{'optionsMenu.q5' | translate }}</u>
                                                    </a>
                                                    <div ngbDropdownMenu aria-labelledby="dropdownLang"
                                                        class="dropdownLang">
                                                        <a class="dropdown-item py-1 lang" href="javascript:;"
                                                            (click)="selectCustomSuggestion('optionsMenu.q5.1')">
                                                            <span>{{'optionsMenu.q5.1' | translate }}</span>
                                                        </a>
                                                        <a class="dropdown-item py-1 lang" href="javascript:;"
                                                            (click)="selectCustomSuggestion('optionsMenu.q5.2')">
                                                            <span>{{'optionsMenu.q5.2' | translate }}</span>
                                                        </a>
                                                        <a class="dropdown-item py-1 lang" href="javascript:;"
                                                            (click)="selectCustomSuggestion('optionsMenu.q5.3')">
                                                            <span>{{'optionsMenu.q5.3' | translate }}</span>
                                                        </a>
                                                        <a class="dropdown-item py-1 lang" href="javascript:;"
                                                            (click)="selectCustomSuggestion('optionsMenu.q5.4')">
                                                            <span>{{'optionsMenu.q5.4' | translate }}</span>
                                                        </a>
                                                        <a class="dropdown-item py-1 lang" href="javascript:;"
                                                            (click)="selectCustomSuggestion('optionsMenu.q5.5')">
                                                            <span>{{'optionsMenu.q5.5' | translate }}</span>
                                                        </a>
                                                        <a class="dropdown-item py-1 lang" href="javascript:;"
                                                            (click)="selectCustomSuggestion('optionsMenu.q5.6')">
                                                            <span>{{'optionsMenu.q5.6' | translate }}</span>
                                                        </a>
                                                        <a class="dropdown-item py-1 lang" href="javascript:;"
                                                            (click)="selectCustomSuggestion('optionsMenu.q5.7')">
                                                            <span>{{'optionsMenu.q5.7' | translate }}</span>
                                                        </a>
                                                        <a class="dropdown-item py-1 lang" href="javascript:;"
                                                            (click)="selectCustomSuggestion('optionsMenu.q5.8')">
                                                            <span>{{'optionsMenu.q5.8' | translate }}</span>
                                                        </a>
                                                        <a class="dropdown-item py-1 lang" href="javascript:;"
                                                            (click)="selectCustomSuggestion('optionsMenu.q5.9')">
                                                            <span>{{'optionsMenu.q5.9' | translate }}</span>
                                                        </a>
                                                    </div>
                                                </li>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="card card-body card-custom d-flex justify-content-center align-items-center pointer"
                                                (click)="selectCustomSuggestion('optionsMenu.q6')">
                                                {{'optionsMenu.q6' | translate }}
                                            </div>
                                        </div>
                                        <p class="text-muted small mt-2">
                                            <em>{{'optionsMenu.hint' | translate }}</em>
                                        </p>
                                    </div>
                                </div>
                            </ng-container>
                            <ng-container *ngIf="showOptionsData == 'summaryTypes'">
                                <div class="col-md-12">
                                    <div class="row">
                                        <div class="col-md-6" *ngFor="let summaryType of summaryTypes">
                                            <div class="card card-body card-custom d-flex justify-content-center align-items-center pointer"
                                                (click)="selectSummaryType(summaryType.description)">
                                                <h5>{{summaryType.title | translate}}</h5>
                                                <p>{{summaryType.description | translate}}</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </ng-container>
                            <ng-container *ngIf="showOptionsData != 'general' && showOptionsData != 'summaryTypes'">
                                <div class="col-md-12">
                                    <ng-container *ngIf="actualCategory == null">
                                        <div class="row">
                                            <p class="col-md-12 mb-0 mt-2 black text-bold-700">{{'generics.Select a
                                                category' | translate }}:</p>
                                            <span class="col-md-12" *ngIf="showOptionsData == 'categoriesPatients'">
                                                <div class="row">
                                                    <div *ngFor="let categorie of categoriesPatients" class="col-md-4">
                                                        <div class="card card-body border card-categorie d-flex justify-content-center align-items-center pointer"
                                                            (click)="selectCategorie(categorie)">
                                                            <img class="logo-img-big" style="width: 60px;"
                                                                [src]="categorie.icon" /> <u>{{categorie.title}} </u>
                                                        </div>
                                                    </div>
                                                </div>
                                            </span>
                                            <span class="col-md-12" *ngIf="showOptionsData == 'categoriesCaregivers'">
                                                <div class="row">
                                                    <div *ngFor="let categorie of categoriesCaregivers"
                                                        class="col-md-4">
                                                        <div class="card card-body border card-categorie d-flex justify-content-center align-items-center pointer"
                                                            (click)="selectCategorie(categorie)">
                                                            <img class="logo-img-big" style="width: 60px;"
                                                                [src]="categorie.icon" /> <u>{{categorie.title}} </u>
                                                        </div>
                                                    </div>
                                                </div>
                                            </span>
                                        </div>
                                    </ng-container>
                                    <ng-container *ngIf="actualCategory != null">
                                        <div class="row">
                                            <div class="col-md-12 center-elements">
                                                <!-- Botón para regresar o seleccionar otra categoría -->
                                                <button class="btn btn-dark" (click)="actualCategory = null"><em
                                                        class="fa fa-arrow-up"></em> {{'generics.Back to categories' |
                                                    translate }}</button>
                                                <!-- Icono y nombre de la categoría seleccionada -->
                                                <div class="category-header mt-4">
                                                    <img class="logo-img-small" style="width: 30px; height: 30px;"
                                                        src="{{actualCategory.icon}}" />
                                                    <span class="text-bold-700">{{actualCategory.title}}</span>
                                                </div>
                                            </div>
                                            <div class="col-md-12">
                                                <div class="row">
                                                    <div *ngFor="let suggestion of actualCategory.questions"
                                                        class="col-md-4">
                                                        <div class="card card-body card-custom d-flex justify-content-center align-items-center pointer"
                                                            (click)="selectSuggestion(suggestion)">
                                                            {{suggestion}}
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </ng-container>
                                </div>
                            </ng-container>
                            <p class="mt-2" *ngIf="docs.length == 0" [innerHTML]="'optionsMenu.t7' | translate"></p>
                        </div>
                    </ng-container>
                    <div *ngIf="messages.length > 0" class="main-chat-container">
                        <div class="chat-container">
                            <div *ngFor="let message of messages; let i = index" class="chat-messages"
                                [ngClass]="{'user-is-sender': message.isUser}"
                                [@messageAnimation]>
                                <div class="message-row"
                                    [ngClass]="{'user-message': message.isUser, 'response-message': !message.isUser, 'response-form': !message.isUser}">
                                    <ng-container *ngIf="message.task">
                                        <span [innerHTML]="message.text | safe: 'html'"
                                            (click)="onMessageClick($event, i)"></span>
                                        <span *ngIf="message.task.steps">
                                            <small class="noti-text d-block mb-1 mt-2"
                                                *ngFor="let step of message.task.steps">
                                                <em *ngIf="step.status == 'pending'" class="fa fa-clock-o"></em>
                                                <em *ngIf="step.status == 'inProcess'"
                                                    class="fa fa-spinner primary fa-spin"></em>
                                                <em *ngIf="step.status == 'finished'" class="success fa fa-check"></em>
                                                <em *ngIf="step.status == 'failed'"
                                                    class="danger fa-solid fa-file-exclamation"
                                                    title="{{'generics.A file has failed and needs to be deleted' | translate }}"></em>
                                                <span class="ml-1" *ngIf="step.name">{{step.name}}</span>
                                                <span class="mb-1 d-block" *ngIf="step.data && step.data !== undefined"
                                                    style="margin-left: 1rem !important"><strong>{{step.data}}
                                                        {{'messages.m4.3' | translate }}</strong> </span>
                                                <span
                                                    *ngIf="step.status == 'finished' && step.name != translateYouCanAskInChat && step.action !== undefined"
                                                    class="ml-1" [innerHTML]="step.action | safe: 'html'"
                                                    (click)="onMessageClick($event, i)"></span>
                                            </small>
                                        </span>
                                    </ng-container>
                                    <ng-container *ngIf="message.file">
                                        <span class="d-block">{{'documents.Select document' | translate }}: </span>
                                        <div class="row">
                                            <div class="col-md-4" *ngIf="showCameraButton">
                                                <div><button style="min-height: 45px;" class="btn btn-sm btn-dark mt-2"
                                                        (click)="entryOpt('opt1', contentPhoto)">{{'demo.Take a photo' |
                                                        translate }}</button></div>
                                            </div>
                                            <div [ngClass]="{'col-md-4': showCameraButton, 'col-6': !showCameraButton}">
                                                <input *ngIf="!isMobile" type="file" #fileDropRef id="fileDropRef"
                                                    multiple style="display: none;" (change)="onFileChangeStep($event);"
                                                    accept=".pdf, .docx, .jpg, .png, .jpeg, .txt" />
                                                <input *ngIf="isMobile" type="file" #fileDropRef id="fileDropRef"
                                                    multiple style="display: none;"
                                                    (change)="onFileChangeStep($event);" />
                                                <label style="min-height: 45px;"
                                                    class="mb-1 mt-2 btn btn-dark btn-sm mb-0"
                                                    style="text-transform: none;letter-spacing: 0px;cursor: pointer;"
                                                    for="fileDropRef">{{'generics.Upload' | translate }}
                                                </label>
                                                <span class="text-muted small d-block">{{'demo.Max. 5 documents' |
                                                    translate }}</span>
                                            </div>
                                            <div [ngClass]="{'col-md-4': showCameraButton, 'col-6': !showCameraButton}">
                                                <div><button style="min-height: 45px;" class="btn btn-sm btn-dark mt-2"
                                                        (click)="entryOpt('opt2', contentManual)">{{'demo.Write text' |
                                                        translate }}</button></div>
                                            </div>
                                        </div>
                                    </ng-container>
                                    <ng-container *ngIf="!message.task && !message.file">
                                        <span [innerHTML]="message.text | safe: 'html'"
                                            (click)="onMessageClick($event, i)"></span>
                                        <span *ngIf="!message.isUser" class="d-block mt-2">
                                            <button class="btn btn-sm btn-white"
                                                (click)="addNoteWithMessage(message.text)" [disabled]="savingNote"
                                                title="{{'notes.Save to notes' | translate }}">
                                                <em class="fa-solid fa-thumbtack mr-1"></em> {{'notes.Save to notes' |
                                                translate }}
                                            </button>
                                            <span *ngIf="!message.isUser">
                                                <span class="float-right">
                                                    <em class="fa fa-clipboard pointer" (click)="copymsg(message)"
                                                        title="{{'generics.Copy' | translate }}"></em>
                                                    <em class="fa fa-thumbs-up ml-2 pointer" *ngIf="i != 0"
                                                        (click)="sendFeedback(true, message.text)"
                                                        title="{{'generics.Like' | translate }}"></em>
                                                    <em class="fa fa-thumbs-down ml-2 pointer" *ngIf="i != 0"
                                                        (click)="sendFeedback(false, message.text)"
                                                        title="{{'generics.Dislike' | translate }}"></em>
                                                </span>
                                            </span>
                                        </span>


                                    </ng-container>
                                </div>
                            </div>
                            <div class="chat-messages pt-2"
                                *ngIf="(callingOpenai || gettingSuggestions) || actualStatus == 'generando sugerencias'">
                                <div style="display: inline-block;">
                                    <div class="loading-dots">
                                        <em class="fa fa-circle"></em>
                                        <em class="fa fa-circle"></em>
                                        <em class="fa fa-circle"></em>
                                    </div>
                                    <span class="typewriter-text" style="color: #6c757d; font-size: 0.95rem;"
                                        [innerHTML]="messagesExpectOutPut">
                                    </span>
                                </div>
                            </div>
                            <span>
                                <span *ngIf="proposedEvents.length > 0" class="mb-2" style="display: flex;">
                                    <span class="border"
                                        style="background-color: white !important;border-radius: 1rem;">
                                        <span *ngIf="proposedEvents.length == 1">
                                            <h6 class="m-2" *ngIf="proposedEvents.length == 1">{{'events.event has been
                                                detected' | translate}}</h6>
                                            <p class="m-2">{{'events.We need you to validate if is correct' |
                                                translate}}</p>
                                        </span>
                                        <span *ngIf="proposedEvents.length > 1">
                                            <h6 class="m-2" *ngIf="proposedEvents.length > 1">{{'events.events have been
                                                detected' | translate: { value: proposedEvents.length } }}</h6>
                                            <p class="m-2">{{'events.Save or delete to continue the conversation' |
                                                translate}}</p>
                                        </span>
                                        <div *ngFor="let proposedEvent of proposedEvents; let j = index" class="m-2">
                                            <hr class="mt-2 mb-2">
                                            <p class=""><strong>{{'generics.Name' | translate}}:</strong><span
                                                    class="ml-1">{{proposedEvent.insight}}</span></p>
                                            <p class=""><strong>{{'generics.Date' | translate}}:</strong><span
                                                    class="ml-1">{{proposedEvent.date | date: timeformat}}</span></p>
                                            <p class=""><strong>{{'timeline.Event type' | translate }}:</strong>
                                                <span class="ml-1"> {{getEventTypeDisplay(proposedEvent.key)}}

                                                </span>
                                            </p>
                                            <p *ngIf="!proposedEvent.saving && !submitted">
                                                <button class="mb-1 btn btn-white btn-sm mr-1" title=""
                                                    (click)="editProposedEvent(proposedEvent)"><i
                                                        class="fa fa-edit success"></i> {{'generics.Edit' |
                                                    translate}}</button>
                                                <button class="mb-1 btn btn-white btn-sm ml-1 mr-1" title=""
                                                    (click)="addProposedEvent(proposedEvent)"><i
                                                        class="fa fa-plus success"></i> {{'generics.Save' |
                                                    translate}}</button>
                                                <button class="mb-1 btn btn-white btn-sm ml-1" title=""
                                                    (click)="deleteProposedEvent(j)"><i class="fa fa-trash danger"></i>
                                                    {{'generics.Delete' | translate}}</button>
                                            </p>
                                            <p *ngIf="proposedEvent.saving">
                                                <em class="fa fa-spinner fa-spin fa-2x fa-fw primary"></em>
                                            </p>
                                        </div>
                                        <div *ngIf="proposedEvents.length > 1"
                                            class="border-top pt-3 pb-2 center-elements">
                                            <button class="mb-1 btn btn-white btn-sm mr-1" title=""
                                                (click)="addAllProposedEvents()"><i class="fa fa-plus success"></i>
                                                {{'generics.Save all' | translate}}</button>
                                            <button class="mb-1 btn btn-white btn-sm ml-1" title=""
                                                (click)="deleteAllProposedEvents()"><i class="fa fa-trash danger"></i>
                                                {{'generics.Delete all' | translate}}</button>
                                        </div>
                                    </span>
                                </span>
                                <span *ngIf="proposedAppointments.length > 0" class="mb-2" style="display: flex;">
                                    <span class="border"
                                        style="background-color: white !important;border-radius: 1rem;">
                                        <span *ngIf="proposedAppointments.length == 1">
                                            <h6 class="m-2" *ngIf="proposedAppointments.length == 1">{{'events.event has
                                                been detected' | translate}}</h6>
                                            <p class="m-2">{{'events.We need you to validate if is correct' |
                                                translate}}</p>
                                        </span>
                                        <span *ngIf="proposedAppointments.length > 1">
                                            <h6 class="m-2" *ngIf="proposedAppointments.length > 1">{{'events.events
                                                have been detected' | translate: { value: proposedAppointments.length }
                                                }}</h6>
                                            <p class="m-2">{{'events.Save or delete to continue the conversation' |
                                                translate}}</p>
                                        </span>
                                        <div *ngFor="let proposedAppointment of proposedAppointments; let j = index"
                                            class="m-2">
                                            <hr class="mt-2 mb-2">
                                            <p class=""><strong>{{'generics.Name' | translate}}:</strong><span
                                                    class="ml-1">{{proposedAppointment.insight}}</span></p>
                                            <p class=""><strong>{{'generics.Date' | translate}}:</strong><span
                                                    class="ml-1">{{proposedAppointment.date | date: timeformat}}</span>
                                            </p>
                                            <p *ngIf="!proposedAppointment.saving && !submitted">
                                                <button class="mb-1 btn btn-white btn-sm mr-1"
                                                    title="{{'generics.Edit' | translate}}"
                                                    (click)="editProposedAppointment(proposedAppointment)"><i
                                                        class="fa fa-edit success"></i> {{'generics.Edit' |
                                                    translate}}</button>
                                                <button class="mb-1 btn btn-white btn-sm ml-1 mr-1"
                                                    title="{{'generics.Save' | translate}}"
                                                    (click)="addProposedAppointment(proposedAppointment)"><i
                                                        class="fa fa-plus success"></i> {{'generics.Save' |
                                                    translate}}</button>
                                                <button class="mb-1 btn btn-white btn-sm ml-1"
                                                    title="{{'generics.Delete' | translate}}"
                                                    (click)="deleteProposedAppointment(j)"><i
                                                        class="fa fa-trash danger"></i> {{'generics.Delete' |
                                                    translate}}</button>
                                            </p>
                                            <p *ngIf="proposedAppointment.saving">
                                                <em class="fa fa-spinner fa-spin fa-2x fa-fw primary"></em>
                                            </p>
                                        </div>
                                        <div *ngIf="proposedAppointments.length > 1"
                                            class="border-top pt-3 pb-2 center-elements">
                                            <button class="mb-1 btn btn-white btn-sm mr-1"
                                                title="{{'generics.Save all' | translate}}"
                                                (click)="addAllProposedAppointments()"><i
                                                    class="fa fa-plus success"></i> {{'generics.Save all' |
                                                translate}}</button>
                                            <button class="mb-1 btn btn-white btn-sm ml-1"
                                                title="{{'generics.Delete all' | translate}}"
                                                (click)="deleteAllProposedAppointments()"><i
                                                    class="fa fa-trash danger"></i> {{'generics.Delete all' |
                                                translate}}</button>
                                        </div>
                                    </span>
                                </span>
                                <span
                                    *ngIf="suggestions.length > 0 && proposedEvents.length == 0 && proposedAppointments.length == 0"
                                    class="suggestion-items">
                                    <span *ngFor="let suggestion of suggestions" class="suggestion-item"
                                        title="{{suggestion}}">
                                        <button class="btn btn-sm btn-outline-dark"
                                            (click)="selectSuggestion(suggestion)">{{suggestion}}</button>
                                    </span>
                                    <span class="suggestion-item">
                                        <button class="btn btn-sm btn-outline-dark"
                                            (click)="showOptionsMenu(ContentOptionsMenu)"
                                            title="{{'topnavbar.Help' | translate }}">
                                            <img class="icon-dark" height="18px"
                                                src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAACXBIWXMAAAsTAAALEwEAmpwYAAABcUlEQVR4nM1VvU7DQAyOYGOAoTC0kx07VTdeggmJkQ0YeYOK92FkomqYeI0KCUREpdidGJHKQFXk0krJkaRHmwKWTqf78+efz74g+G15Zd5VhsckDPc2AjBiPFPGqc0bAVDGngHYXLvyEfOBMo7nAGNbr63UYj0PSy+jfDHGtm/nbk6k02oowbPNlQDCOHSUFg4hfMm9i6A724+gWwmgzeaOMJ4I47UQvuUUE7wrQT8luMh6MA2CLSFMZgCMw2kQbNeagzQMj7OG2NoLIMsiYbwtvwN3jqdxbXWQRnAojJNcfhgntu9dyZZQN+aphYUgdpVnQezc7tl9fwoTXArhgw/TMoxLlOFK2+39WiisZUCMw7/1YCEz3kd4pIw3wvhRkYN7YTytrAuzWhmeLNlF52uzaERwvqxdK0Hs1EHfu+kJw+DLKhjYusiTlSq5jDHiNLlvvYgw8eK9WerrwY+66apfpnRaDfN66X/gSlGr+NfyCUefppTLiRp8AAAAAElFTkSuQmCC">
                                        </button>
                                    </span>
                                </span>
                            </span>
                        </div>
                    </div>
                    <a id="chatContainer"></a>
                    <div class="chat-input-container mb-5">
                        <!--<div class="d-flex align-items-center input-container" *ngIf="!callingOpenai && proposedEvents.length == 0 && proposedAppointments.length == 0">-->
                        <div class="d-flex align-items-center input-container" id="chat-container">
                            <input type="text" [(ngModel)]="message" [disabled]="callingOpenai"
                                placeholder="{{'generics.Write a message' | translate }}..."
                                (keydown.enter)="sendMessage()" class="mt-0 border-0 mr-2 flex-grow-1">
                            <button *ngIf="role != 'Caregiver'" class="mr-1 btn btn-secondary" title="{{'generics.Upload' | translate }}"
                                style="padding: 0.2rem 0.57rem;" [disabled]="callingOpenai"
                                (click)="openOptionsFiles(contentviewSelectFile)">
                                <em class="fa fa-paperclip fa-rotate-180 h-4 w-auto" width="1em" height="1em"
                                    fill="currentColor"></em>
                            </button>
                            <button class="mr-1 btn btn-dark" title="{{'generics.Submit' | translate }}"
                                style="padding: 0.2rem 0.57rem;" [disabled]="callingOpenai" (click)="sendMessage()">
                                <svg *ngIf="!callingOpenai" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em"
                                    fill="currentColor" viewBox="0 0 256 256" class="h-4 w-auto">
                                    <path
                                        d="M232,127.89a16,16,0,0,1-8.18,14L55.91,237.9A16.14,16.14,0,0,1,48,240a16,16,0,0,1-15.05-21.34L60.3,138.71A4,4,0,0,1,64.09,136H136a8,8,0,0,0,8-8.53,8.19,8.19,0,0,0-8.26-7.47H64.16a4,4,0,0,1-3.79-2.7l-27.44-80A16,16,0,0,1,55.85,18.07l168,95.89A16,16,0,0,1,232,127.89Z">
                                    </path>
                                </svg>
                                <em class="fa fa-spinner fa-spin fa-fw white" *ngIf="callingOpenai"></em>
                            </button>
                        </div>
                    </div>
                </div>
            </ng-container>

            <ng-container *ngIf="false">
                <!--<div class="col-xl-4 col-lg-6 col-md-6 col-12">
                        <div class="card gradient-mint">
                            <div class="card-content">
                                <div class="card-body py-0">
                                    <div class="media">
                                        <div class="media-body white text-left">
                                            <h3 class="font-medium-3 white mb-0">{{'home.donate_data' | translate }}</h3>
                                        </div>
                                        <div class="media-right white text-right">
                                            <em class="fa fa-gift font-medium-3"></em>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="mt-3 ml-3 mr-3 mb-0 white">
                                <p>{{'home.donate_explanation' | translate }}</p>
                                <p>{{'home.donate_anonymity' | translate }}</p>
                                <div class="mt-2" *ngIf="!changingDonation">
                                    <button *ngIf="!isDonating" class="mb-3 mt-3 btn btn-dark mb-0" (click)="startDonating()">
                                        {{'home.start_donating' | translate }}
                                    </button>
                                    <button *ngIf="isDonating" class="mb-3 mt-3 btn btn-danger mb-0" (click)="stopDonating()">
                                        {{'home.stop_donating' | translate }}
                                    </button>
                                </div>
                                <div class="mt-3 mb-3" *ngIf="changingDonation">
                                    <em class="fa fa-spinner fa-spin fa-2x fa-fw primary"></em>
                                </div>
                            </div>
                        </div>
                    </div>-->
            </ng-container>
        </div>
        <div *ngIf="currentView === 'diary'" class="col-md-12" [ngClass]="{'pt-custom2': !isSmallScreen()}">
            <div class="diary-content">
                <app-diary></app-diary>
            </div>
        </div>

        <!-- New Notes sidebar -->
        <div *ngIf="currentView === 'notes'" class="col-md-12 diary-container pt-20px" [ngClass]="{'open': notesSidebarOpen, 'pt-custom': !isSmallScreen()}">
            <div class="diary-content">
                <div class="sidebar-header center-elements">
                    <button (click)="getPatientSummary(false)" [disabled]="openingSummary" class="mt-2 mr-2 btn btn-dark"
                        title="{{'home.Patient Summary' | translate }}">
                        <span *ngIf="!openingSummary" class="white"><i class="fa fa-file-text-o me-2 white mr-1"></i> {{'home.Patient Summary' | translate }}</span>
                        <span *ngIf="openingSummary"><em class="fa fa-spinner fa-spin fa-fw primary"></em></span>
                    </button> 
                    <button type="button" class="mt-2 btn btn-dark" (click)="addNote(addNoteModal)"
                    title="{{'notes.Add Note' | translate}}"><i class="white fa fa-plus mr-1"></i> {{'notes.Add Note' | translate}}</button>                   
                </div>
                <div *ngIf="notes.length > 0" class="pb-3">
                    <ul class="notes-list">
                        <li *ngFor="let note of notes; let i = index" class="mt-3 card bg-grey bg-lighten-4">
                            <div class="note-content">
                                <!-- Modo visualización -->
                                <div *ngIf="!note.isEditing">
                                    <p [innerHTML]="note.content | safe: 'html'"></p>
                                    <small>{{note.date | date: 'longDate'}}</small>
                                    <div class="mt-2">
                                        <div class="btn-group" role="group">
                                            <button (click)="deleteNote(i)" class="btn btn-sm btn-danger" [disabled]="deletingNote" title="{{'generics.Delete' | translate }}">
                                                <i class="fa fa-trash"></i>
                                            </button>
                                            <button (click)="copymsg(note.content)" class="btn btn-sm btn-white custom-white-button" title="{{'generics.Copy' | translate }}">
                                                <i class="fa fa-copy"></i>
                                            </button>
                                            <button (click)="editNote(i)" class="btn btn-sm btn-white custom-white-button" title="{{'generics.Edit' | translate }}">
                                                <i class="fa fa-edit"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>
    
                                <!-- Modo edición -->
                                <div *ngIf="note.isEditing">
                                    <div class="custom-body text-left p-2 border rounded mb-2" contenteditable="true"
                                        [id]="'editableNote' + i">
                                        <span [innerHTML]="note.content | safe: 'html'"></span>
                                    </div>
                                    <div>
                                        <button class="btn btn-sm btn-success mr-2" (click)="saveNoteEdit(i)"
                                            [disabled]="savingNote" title="{{'generics.Save' | translate }}">
                                            <em class="fa fa-check"></em> {{'generics.Save' | translate }}
                                        </button>
                                        <button class="btn btn-sm btn-danger" (click)="cancelNoteEdit(i)"
                                            title="{{'generics.Cancel' | translate }}">
                                            <em class="fa fa-times"></em> {{'generics.Cancel' | translate }}
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </li>
                    </ul>
                </div>
                <div *ngIf="notes.length === 0">
                    <div class="center-elements pt-3">
                        <p>{{'notes.noNotes' | translate}}</p>
                    </div>
                </div>

            </div>
            
        </div>

        <!-- DxGPT View -->
        <div *ngIf="currentView === 'dxgpt'" class="col-md-12" [ngClass]="{'pt-custom2': !isSmallScreen()}">
            <div class="dxgpt-content p-4">
                <div class="text-center">
                    <h3 class="mb-4">{{ 'dxgpt.title' | translate }}</h3>

                    <!-- Loading state -->
                    <div *ngIf="isDxGptLoading" class="my-5">
                        <div class="spinner-border text-primary" role="status">
                            <span class="sr-only">Loading...</span>
                        </div>
                        <p class="mt-3 text-muted">{{ 'dxgpt.analyzing' | translate }}</p>
                    </div>

                    <!-- Button to fetch results (Initial state) -->
                    <div *ngIf="!isDxGptLoading && !dxGptResults" class="my-5">
                        <p class="mb-4">{{ 'dxgpt.description' | translate }}</p>
                        <button 
                            type="button"
                            class="btn btn-primary btn-lg" 
                            (click)="fetchDxGptResults()" 
                            [disabled]="!currentPatientId">
                            <i class="fa fa-stethoscope mr-2"></i>
                            {{ 'dxgpt.analyze' | translate }}
                        </button>
                        <p *ngIf="!currentPatientId" class="text-danger mt-2">
                            {{ 'patients.No patient selected' | translate }}
                        </p>
                    </div>

                    <!-- Results with existing styles -->
                    <div *ngIf="!isDxGptLoading && dxGptResults && dxGptResults.success && dxGptResults.analysis" 
                         class="dxgpt-results text-left">
                        
                        <!-- Anonymized patient info -->
                        <div class="alert alert-info mb-4" *ngIf="dxGptResults.analysis.anonymization">
                            <h5 class="alert-heading d-flex align-items-center">
                                <i class="fa fa-user-shield mr-2"></i>
                                {{ 'dxgpt.patientInfo' | translate }}
                            </h5>
                            <p class="mb-0">{{ dxGptResults.analysis.anonymization.anonymizedText }}</p>
                        </div>

                        <!-- Diagnoses title -->
                        <h4 class="mb-4">{{ 'dxgpt.possibleDiagnoses' | translate }}</h4>
                        
                        <!-- Diagnoses as full-width strips -->
                        <div class="diagnosis-cards-container">
                            <div *ngFor="let diagnosis of dxGptResults.analysis.data; let i = index" 
                                 class="mb-3">
                                <div class="card diagnosis-card">
                                    <div class="card-body">
                                        <!-- Diagnosis header -->
                                        <div class="d-flex align-items-start mb-3">
                                            <span class="badge badge-primary mr-3" style="min-width: 2rem;">
                                                {{ i + 1 }}
                                            </span>
                                            <div class="flex-grow-1">
                                                <h5 class="diagnosis-name mb-2">
                                                    {{ diagnosis.diagnosis }}
                                                </h5>
                                                <p class="card-text text-muted">
                                                    {{ diagnosis.description }}
                                                </p>
                                            </div>
                                        </div>
                                        
                                        <!-- Symptoms section -->
                                        <div class="symptoms-section pl-5">
                                            <!-- Matching symptoms -->
                                            <div class="mb-2" 
                                                 *ngIf="diagnosis.symptoms_in_common">
                                                <div class="symptoms-header text-success mb-2">
                                                    <i class="fa fa-check-circle mr-1"></i>
                                                    {{ 'dxgpt.matchingSymptoms' | translate }}
                                                    <span class="badge badge-success badge-pill ml-2">
                                                        {{ diagnosis.symptoms_in_common.length }}
                                                    </span>
                                                </div>
                                                <div class="symptoms-list">
                                                    <span *ngFor="let symptom of diagnosis.symptoms_in_common" 
                                                          class="badge badge-success mr-1 mb-1">
                                                        {{ symptom }}
                                                    </span>
                                                </div>
                                            </div>
                                            
                                            <!-- Additional symptoms -->
                                            <div *ngIf="diagnosis.symptoms_not_in_common">
                                                <div class="symptoms-header text-muted mb-2">
                                                    <i class="fa fa-plus-circle mr-1"></i>
                                                    {{ 'dxgpt.additionalSymptoms' | translate }}
                                                    <span class="badge badge-secondary badge-pill ml-2">
                                                        {{ diagnosis.symptoms_not_in_common.length }}
                                                    </span>
                                                </div>
                                                <div class="symptoms-list">
                                                    <span *ngFor="let symptom of diagnosis.symptoms_not_in_common" 
                                                          class="badge badge-secondary mr-1 mb-1">
                                                        {{ symptom }}
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Button to analyze again -->
                        <div class="text-center mt-5">
                            <button 
                                type="button"
                                class="btn btn-secondary btn-lg" 
                                (click)="resetDxGptResults()">
                                <i class="fa fa-redo mr-2"></i>
                                {{ 'dxgpt.analyzeAgain' | translate }}
                            </button>
                        </div>
                    </div>

                    <!-- Error state -->
                    <div *ngIf="!isDxGptLoading && dxGptResults && !dxGptResults.success" 
                         class="alert alert-danger mt-4">
                        <div class="alert-heading d-flex align-items-center mb-3">
                            <i class="fa fa-exclamation-triangle mr-2"></i>
                            <h5 class="mb-0">{{ 'general.error' | translate }}</h5>
                        </div>
                        <p class="mb-3">
                            {{ dxGptResults.error || ('dxgpt.errorMessage' | translate) }}
                        </p>
                        <hr>
                        <button 
                            type="button"
                            class="btn btn-outline-danger" 
                            (click)="resetDxGptResults()">
                            <i class="fa fa-redo mr-1"></i>
                            {{ 'dxgpt.tryAgain' | translate }}
                        </button>
                    </div>
                </div>
            </div>
        </div>

    </div>
</ng-container>

<ng-template #timelineModal let-modal>
    <div class="modal-header">
        <h4 class="modal-title">{{'timeline.Timeline' | translate }}</h4>
        <button type="button" class="close" aria-label="Close" (click)="modal.dismiss()">
            <span aria-hidden="true">&times;</span>
        </button>
    </div>
    <div class="modal-body">
        <!-- Aquí va todo el contenido del timeline que tenías antes -->
        <div class="">
            <div class="card-content" style="background-color: #d9d9d9;">
                <div class="card-body py-0">
                    <div class="media">
                        <div class="media-body text-left">
                            <span>
                                <h3 class="font-medium-3 mb-0">
                                    {{timeline.length}}</h3>
                            </span>
                            <span>{{'timeline.Timeline' | translate }}</span>
                        </div>
                        <div class="media-right text-right">
                            <button class="btn btn-white btn-sm mb-2" (click)="toggleFilters()">
                                <span *ngIf="!showFilters">{{'timeline.Show filters' | translate }}</span>
                                <span *ngIf="showFilters">{{'timeline.Hide filters' | translate }}</span>
                            </button>
                        </div>
                    </div>
                    <div class="row d-block-inline" *ngIf="showFilters">
                        <div class="col-md-12">{{'timeline.Filter by' | translate }}</div>
                        <div class="col-md-12 customcol aligself-start">
                            <mat-form-field>
                                <mat-label>{{'timeline.Start date' | translate }}</mat-label>
                                <input readonly matInput [matDatepicker]="picker" [(ngModel)]="startDate"
                                    (dateChange)="filterEvents()" (click)="picker.open()">
                                <button *ngIf="startDate != null" matSuffix mat-icon-button aria-label="Clear"
                                    (click)="resetStartDate(null)" style="position: absolute; left: 30px;">
                                    <em class="fa fa-trash danger"></em>
                                </button>
                                <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
                                <mat-datepicker touchUi="true" #picker></mat-datepicker>
                            </mat-form-field>
                        </div>
                        <div class="col-md-12 customcol aligself-start">
                            <mat-form-field>
                                <mat-label>{{'timeline.End date' | translate }}</mat-label>
                                <input readonly matInput [matDatepicker]="picker2" [(ngModel)]="endDate"
                                    (dateChange)="filterEvents()" (click)="picker2.open()">
                                <button *ngIf="endDate != null" matSuffix mat-icon-button aria-label="Clear"
                                    (click)="resetEndDate(null)" style="position: absolute; left: 30px;">
                                    <em class="fa fa-trash danger"></em>
                                </button>
                                <mat-datepicker-toggle matSuffix [for]="picker2"></mat-datepicker-toggle>
                                <mat-datepicker touchUi="true" #picker2></mat-datepicker>
                            </mat-form-field>
                        </div>
                        <div class="col-md-12 customcol aligself-start">
                            <mat-form-field>
                                <mat-label>{{'timeline.Event type' | translate }}</mat-label>
                                <mat-select [(ngModel)]="selectedEventType" (selectionChange)="filterEvents()">
                                    <mat-option [value]="null">{{'timeline.All Event Types' | translate }}</mat-option>
                                    <mat-option value="diagnosis">{{'timeline.Diagnoses' | translate }} 🩺</mat-option>
                                    <mat-option value="treatment">{{'timeline.Treatment' | translate }} 💉</mat-option>
                                    <mat-option value="test">{{'timeline.Tests' | translate }} 🔬</mat-option>
                                    <mat-option value="appointment">{{'events.appointment' | translate }}
                                        📅</mat-option>
                                    <mat-option value="symptom">{{'timeline.Symptoms' | translate }} 🤒</mat-option>
                                    <mat-option value="medication">{{'timeline.Medications' | translate }}
                                        💊</mat-option>
                                    <mat-option value="other">{{'timeline.Other' | translate }} 🔍</mat-option>
                                </mat-select>
                            </mat-form-field>
                        </div>
                    </div>
                </div>
            </div>
            <div class="p-2">
                <div class="timeline" *ngIf="groupedEvents.length > 0">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <span class="pointer" (click)="toggleEventOrder()"
                            style="text-decoration: underline !important;color: #b30000;">
                            {{'generics.Sort' | translate }} <em class="fa" [class.fa-arrow-down]="!isOldestFirst"
                                [class.fa-arrow-up]="isOldestFirst"></em>
                        </span>
                        <button class="btn btn-sm btn-white" (click)="newMedicalEventTimeline()">
                            <i class="fa fa-plus"></i> {{'events.New Medical Event' | translate }}
                        </button>
                    </div>
                    <div *ngFor="let group of groupedEvents">
                        <div class="timeline-month-title">{{ group.monthYear | date: 'MMMM y' : '' : lang }}</div>
                        <div class="timeline-item" *ngFor="let event of group.events">
                            <div class="timeline-dot"></div>
                            <div class="timeline-content">
                                <div class="d-flex justify-content-between align-items-start">
                                    <div>
                                        <p class="mb-0">
                                            <span
                                                title="{{getEventTypeDisplay(event.key)}}">{{getEventTypeIcon(event.key)}}</span>
                                            {{ event.name }}
                                        </p>
                                        <small class="text-muted">{{ event.date | date }}</small>
                                    </div>
                                    <button class="btn btn-link btn-sm" [matMenuTriggerFor]="menu"
                                        aria-label="More options">
                                        <i class="fa fa-ellipsis-v"></i>
                                    </button>
                                    <mat-menu #menu="matMenu">
                                        <button mat-menu-item (click)="editMedicalEventTimeline(event)">
                                            <i class="fa fa-edit mr-2"></i>
                                            {{'generics.Edit' | translate }}
                                        </button>
                                        <button mat-menu-item (click)="deleteMedicalEvent(event)">
                                            <i class="fa fa-trash mr-2 text-danger"></i>
                                            {{'generics.Delete' | translate }}
                                        </button>
                                    </mat-menu>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div *ngIf="groupedEvents.length == 0">
                    <p>{{'timeline.There are no events' | translate }}</p>
                </div>
            </div>
        </div>
    </div>
</ng-template>
<ng-template #contentSummaryDoc id="contentSummaryDoc" let-c="close" let-d="dismiss" appendTo="body">
    <a id="contentHeader"></a>
    <div class="modal-header border-bottom-0" id="idHeader">
        <button type="button" class="close position-absolute" style="right: 1rem; top: 1rem;" aria-label="Close"
            (click)="closeModal();">
            <span aria-hidden="true">&times;</span>
        </button>
        <div class="content-header text-left row w-100 align-items-center position-relative">

            <div class="col-12 col-xl-9 d-flex flex-column">
                <h4 class="mb-0 editable-title" *ngIf="!editingTitle" (click)="startEditing()">
                    <span class="title-text">{{actualDoc.title}}</span>
                    <span class="edit-overlay">
                        <em class="fa fa-pencil"></em>
                        {{'generics.Change file name' | translate}}
                    </span>
                </h4>
                <div *ngIf="editingTitle" class="d-flex align-items-center">
                    <input #titleInput autoFocus type="text" class="form-control"
                        [ngModel]="getFileNameWithoutExtension(actualDoc.title)"
                        (ngModelChange)="actualDoc.title = $event + actualDoc.title.substring(actualDoc.title.lastIndexOf('.'))"
                        (blur)="saveTitle()" (keyup.enter)="saveTitle()" (keyup.escape)="cancelEditing()"
                        (ngAfterViewInit)="titleInput.focus(); titleInput.select()">
                </div>
                <div>
                    <small><strong>{{'generics.Uploaded on' | translate }}:</strong> {{actualDoc.date | date}}</small>
                    <small *ngIf="actualDoc.originaldate" class="ml-2"><strong>{{'generics.Report date' | translate
                            }}:</strong> {{actualDoc.originaldate | date}}</small>
                    <span class="pointer" (click)="openUpdateDocDate(actualDoc, PanelChangeDate)"
                        title="{{ 'dashboardpatient.Update document date' | translate }}">
                        <em class="fa fa-edit ml-1"></em>
                    </span>
                </div>
            </div>
            <div
                class="col-12 col-xl-3 d-flex justify-content-start justify-content-xl-end align-items-center mt-2 mt-xl-0">
                <span class="dropdown mr-2" ngbDropdown display="dynamic" placement="auto">
                    <button class="btn btn-white" id="dropdownSympt" ngbDropdownToggle
                        title="{{'generics.Options' | translate }}">
                        {{'generics.Options' | translate }}
                    </button>
                    <div ngbDropdownMenu aria-labelledby="dropdownSympt" class="dropdown">
                        <a class="dropdown-item" (click)="getBlobUrl(actualDoc.url)">
                            <i class="fa-1_5x fa fa-eye"></i><span class="ml-2">{{'messages.m5.5' | translate }}</span>
                        </a>
                        <a class="dropdown-item"
                            href="{{accessToken.blobAccountUrl}}{{accessToken.containerName}}/{{actualDoc.url}}{{accessToken.sasToken}}"
                            target="_blank" download>
                            <i class="fa-1_5x fa fa-download"></i><span class="ml-2">{{'generics.Download' | translate
                                }}</span>
                        </a>
                        <div class="dropdown-divider" *ngIf="actualDoc.isOwner"></div>
                        <a *ngIf="actualDoc.status != 'pending' && actualDoc.status != 'inProcess' && actualDoc.isOwner"
                            class="dropdown-item danger" href="javascript:;" (click)="deleteDoc(actualDoc);">
                            <i class="fa-1_5x fa fa-trash"></i><span class="ml-2">{{'generics.Delete' | translate
                                }}</span>
                        </a>
                    </div>
                </span>
            </div>
        </div>
    </div>
    <mat-dialog-content class="mt-2">
        <mat-tab-group [(selectedIndex)]="selectedIndexTab">
            <mat-tab label="{{'generics.Summary' | translate }}">
                <div class="modal-body content-wrapper p-2" id="idBody">
                    <div class="p-1">
                        <div>
                            <span class="animate-bottom" *ngIf="showButtonScroll" id="buttomScroll">
                                <button type="button" class="btn btn-dark round mb-0" (click)="goToTop()">{{'generics.Go
                                    top' | translate }}</button>
                            </span>
                            <span [innerHTML]="summaryDoc | safe: 'html'"></span>
                            <p class="text-muted pt-3 mb-0">{{'generics.generated by artificial intelligence' |
                                translate }}</p>
                        </div>
                    </div>
                </div>
                <div class="modal-footer" id="idFooter" *ngIf="needFeedback">
                    <app-feedback-summary-page [documents]="[actualDoc]" [type]="'individual'" (close)="handleClose2()">
                    </app-feedback-summary-page>
                    <!--<button type="button" class="btn btn-dark" (click)="openFeedback('individual');">{{'feedback.Give us your opinion on the summary' | translate }}</button>-->
                </div>
            </mat-tab>
            <mat-tab label="{{'events.title' | translate }}">
                <div class="modal-body content-wrapper p-2">
                    <div *ngIf="eventsDoc.length>0">
                        <p class="instructions">
                            {{'events.review_validate_events' | translate }}
                        </p>
                        <div class="d-flex justify-content-end mb-2">
                            <div>
                                <span class="badge badge-events bg-danger mr-1"><span class="fa fa-times"></span>
                                    {{'events.incorrect' | translate }}</span>
                                <span class="badge badge-events bg-success mr-1"><span class="fa fa-check"></span>
                                    {{'events.present' | translate }}</span>
                                <span class="badge badge-events bg-warning"><span class="fa fa-calendar"></span>
                                    {{'events.past' | translate }}</span>
                            </div>
                        </div>
                        <ul class="list-group">
                            <li *ngFor="let event of eventsDoc" class="list-group-item">
                                <div class="d-flex justify-content-between" style="align-items: flex-start;">
                                    <div class="pr-1">
                                        <p class="mb-0">
                                            <span title="{{'timeline.Diagnoses' | translate }}" class="fa-1_1x"
                                                *ngIf="event.key == 'diagnosis'">🩺 </span>
                                            <span title="{{'timeline.Treatment' | translate }}" class="fa-1_1x"
                                                *ngIf="event.key == 'treatment'">💉 </span>
                                            <span title="{{'timeline.Tests' | translate }}" class="fa-1_1x"
                                                *ngIf="event.key == 'test'">🔬 </span>
                                            <span title="{{'events.appointment' | translate }}" class="fa-1_1x"
                                                *ngIf="event.key == 'appointment'">📅 </span>
                                            <span title="{{'timeline.Symptoms' | translate }}" class="fa-1_1x"
                                                *ngIf="event.key == 'symptom'">🤒 </span>
                                            <span title="{{'timeline.Medications' | translate }}" class="fa-1_1x"
                                                *ngIf="event.key == 'medication'">💊 </span>
                                            <span title="{{'timeline.Other' | translate }}" class="fa-1_1x"
                                                *ngIf="event.key == 'other'">🔍 </span>
                                            <span class="">{{ event.name }}</span>
                                        </p>
                                        <p>{{ event.date | date }}</p>
                                        <span (click)="explainMedicalEvent(event.name)" class="pointer ml-1"><span
                                                class="fa fa-question-circle-o fa-1_3x"></span></span>
                                        <span (click)="editMedicalEvent(event)" class="pointer ml-1"><span
                                                class="fa fa-pencil fa-1_3x"></span></span>
                                        <span (click)="deleteMedicalEvent(event)" class="pointer ml-1"><span
                                                class="fa fa-trash fa-1_3x"></span></span>
                                    </div>
                                    <div class="mt-1 btn-group btn-group-toggle" ngbRadioGroup
                                        [(ngModel)]="event.status">
                                        <label class="btn btn-outline-danger" ngbButtonLabel>
                                            <input type="radio" ngbButton [value]="'deleted'"
                                                (change)="updateEventStatus(event, 'deleted')"> <span
                                                class="fa fa-times"></span>
                                        </label>
                                        <label class="btn btn-outline-success" ngbButtonLabel>
                                            <input type="radio" ngbButton [value]="'true'"
                                                (change)="updateEventStatus(event, 'true')"> <span
                                                class="fa fa-check"></span>
                                        </label>
                                        <label class="btn btn-outline-warning" ngbButtonLabel>
                                            <input type="radio" ngbButton [value]="'false'"
                                                (change)="updateEventStatus(event, 'false')"> <span
                                                class="fa fa-calendar"></span>
                                        </label>
                                    </div>
                                </div>
                                <div *ngIf="event.notes">
                                    <p class="mt-2 mb-0">{{'notes.title' | translate }}: {{event.notes}}</p>
                                </div>
                            </li>
                        </ul>

                        <div class="d-flex justify-content-between align-items-center mt-3">
                            <span>{{'events.Missing' | translate }}</span>
                            <button class="btn btn-white" (click)="newMedicalEvent(actualDoc)">{{'events.New Medical
                                Event' | translate }}</button>
                        </div>
                    </div>
                    <div *ngIf="eventsDoc.length==0">
                        <p>{{'home.No events have been detected' | translate }}</p>
                        <button class="btn btn-white" (click)="newMedicalEvent(actualDoc)">{{'events.New Medical Event' |
                            translate }}</button>
                    </div>

                </div>
            </mat-tab>
        </mat-tab-group>
    </mat-dialog-content>
    <div class="modal-footer" id="idFooter">
        <button class="btn btn-dark m-2" (click)="closeModal()">{{'generics.Close' |translate }}</button>
    </div>
</ng-template>
<ng-template #contentviewDoc id="contentviewDoc" let-c="close" let-d="dismiss" appendTo="body">
    <div class="modal-header" id="idHeader">
        <div class="content-header text-left">
            <h4 class="mb-0">{{actualDoc.title}}</h4>
            <small><strong>{{'generics.Uploaded on' | translate }}:</strong> {{actualDoc.date | date}}</small>
            <small *ngIf="actualDoc.originaldate" class="ml-2"><strong>{{'generics.Report date' | translate }}:</strong>
                {{actualDoc.originaldate | date}}</small>
        </div>
        <button type="button" class="close" aria-label="Close" (click)="closeModal();">
            <span aria-hidden="true">&times;</span>
        </button>
    </div>
    <div class="modal-body content-wrapper p-2" id="idBody">
        <div class="p-1">
            <div>
                <span class="animate-bottom" *ngIf="showButtonScroll" id="buttomScroll">
                    <button type="button" class="btn btn-dark round mb-0" (click)="goToTop()">{{'generics.Go top' |
                        translate }}</button>
                </span>
                <div class="">
                    <div *ngIf="resultText.length >=5" style="text-align: justify;" class="textExtractedNcr"
                        [innerHTML]="resultText | safe: 'html'"></div>
                    <div *ngIf="resultText.length < 5">
                        {{'home.placeholderError' | translate }}
                    </div>
                </div>
            </div>
        </div>
    </div>
</ng-template>

<ng-template #contentviewSummary id="contentviewSummary" let-c="close" let-d="dismiss" appendTo="body">
    <a id="contentHeader"></a>
    <div class="modal-header" id="idHeader">
        <div class="w-100">
            <!-- Title and close button container -->
            <div class="d-flex justify-content-between align-items-start mb-2">
                <div class="content-header text-left">
                    <h4 class="mb-0">{{'messages.m6.2' | translate }}</h4>
                    <small>{{summaryDate | date}}</small>
                </div>
                <button type="button" class="close" aria-label="Close" (click)="closeModal();">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>

            <!-- Action buttons container -->
            <div class="d-flex flex-wrap">
                <button class="btn btn-sm btn-white mr-2 mb-2" (click)="addNoteWithMessage(summaryJson.data)"
                    [disabled]="savingNote" title="{{'notes.Save to notes' | translate }}">
                    <em class="fa-solid fa-thumbtack mr-1"></em>
                    {{'notes.Save to notes' | translate }}
                </button>

                <button class="btn btn-sm btn-white mr-2 mb-2" (click)="copymsg(summaryJson.data)">
                    <em class="fa fa-copy"></em>
                    {{'generics.Copy' | translate }}
                </button>

                <button class="btn btn-sm btn-white mb-2" (click)="downloadPDF()" [disabled]="generatingPDF">
                    <span *ngIf="!generatingPDF">
                        <em class="fa fa-download"></em>
                        {{'generics.Download' | translate }} PDF
                    </span>
                    <span *ngIf="generatingPDF">
                        <i class="fa fa-spinner fa-spin fa-fw primary"></i>
                        {{'generics.Please wait' | translate }} PDF
                    </span>
                </button>
            </div>
        </div>
    </div>
    <div class="modal-body content-wrapper p-2" id="idBody">
        <div class="p-1">
            <div>
                <span class="animate-bottom" *ngIf="showButtonScroll" id="buttomScroll">
                    <button type="button" class="btn btn-dark round mb-0" (click)="goToTop()">{{'generics.Go top' |
                        translate }}</button>
                </span>
                <div *ngIf="summaryJson && !summaryJson.data">
                    <div class="mt-2">
                        <p>
                            <strong class="mr-1">{{'summary.Name' | translate }}:</strong>
                            <span *ngIf="summaryJson.Name!=''">{{summaryJson.Name}}</span>
                            <span *ngIf="summaryJson.Name==''">-</span>
                        </p>
                        <p>
                            <strong class="mr-1">{{'summary.Age' | translate }}:</strong>
                            <span *ngIf="summaryJson.Age!=''">{{summaryJson.Age}}</span>
                            <span *ngIf="summaryJson.Age==''">-</span>
                        </p>
                        <p>
                            <strong class="mr-1">{{'summary.Gender' | translate }}:</strong>
                            <span *ngIf="summaryJson.Gender!=''">{{summaryJson.Gender}}</span>
                            <span *ngIf="summaryJson.Gender==''">-</span>
                        </p>
                    </div>
                    <!-- <div class="mt-3">
                        <h5>{{'summary.CurrentStatus' | translate }}</h5> 

                        <span *ngIf="isString(summaryJson.CurrentStatus)">
                            {{summaryJson.CurrentStatus}}
                        </span>

                        <ng-container *ngIf="isObject(summaryJson.CurrentStatus)">
                            <p *ngFor="let key of getObjectKeys(summaryJson.CurrentStatus)">
                            <strong class="mr-1">{{key | translate}}:</strong>
                            <span *ngIf="isDate(summaryJson.CurrentStatus[key])">{{summaryJson.CurrentStatus[key] | date}}</span>
                            <span *ngIf="!isDate(summaryJson.CurrentStatus[key])">{{summaryJson.CurrentStatus[key]}}</span>
                            </p>
                        </ng-container>

                        <span *ngIf="!summaryJson.CurrentStatus || summaryJson.CurrentStatus === ''">-</span>
                    </div> -->
                    <div class="mt-3">
                        <h5>{{'summary.Diagnoses' | translate }}</h5>
                        <span *ngIf="summaryJson.Diagnoses.length>0">
                            <ul>
                                <li *ngFor="let item of summaryJson.Diagnoses" class="dot">{{item}}</li>
                            </ul>
                        </span>
                        <span *ngIf="summaryJson.Diagnoses.length==0">
                            <span class="ml-2">{{'summary.No observations' | translate }}</span>
                        </span>
                    </div>
                    <div class="mt-3">
                        <h5>{{'summary.Medication' | translate }}</h5>
                        <span *ngIf="summaryJson.Medication.length>0">
                            <ul>
                                <li *ngFor="let item of summaryJson.Medication" class="dot">{{item}}</li>
                            </ul>
                        </span>
                        <span *ngIf="summaryJson.Medication.length==0">
                            <span class="ml-2">{{'summary.No observations' | translate }}</span>
                        </span>
                    </div>
                    <!-- <div class="mt-3">
                        <h5 *ngIf="summaryJson.Treatments.length>0">{{'summary.Treatments' | translate }}</h5> 
                        <span *ngIf="summaryJson.Treatments.length>0">
                            <ul>
                                <li *ngFor="let item of summaryJson.Treatments" class="dot">{{item}}</li>
                            </ul>
                        </span> 
                        <span *ngIf="summaryJson.Treatments.length==0">
                            <span class="ml-2">{{'summary.No observations' | translate }}</span>
                        </span> 
                    </div> -->
                    <!-- <div class="mt-3">
                        <h5>{{'summary.LaboratoryFindings' | translate }}</h5> 
                        <span *ngIf="summaryJson.LaboratoryFindings.length>0">
                            <ul>
                                <li *ngFor="let item of summaryJson.LaboratoryFindings" class="dot">{{item}}</li>
                            </ul>
                        </span> 
                        <span *ngIf="summaryJson.LaboratoryFindings.length==0">
                            <span class="ml-2">{{'summary.No observations' | translate }}</span>
                        </span> 
                    </div> -->
                    <div class="mt-3 mb-4">
                        <h5>{{'summary.AdditionalInformation' | translate }}</h5>
                        <ng-container *ngIf="summaryJson.AdditionalInformation">
                            <ng-container *ngIf="isString(summaryJson.AdditionalInformation); else notString">
                                {{summaryJson.AdditionalInformation}}
                            </ng-container>
                            <ng-template #notString>
                                <ng-container *ngIf="summaryJson.AdditionalInformation.length > 0; else noObservations">
                                    <ul>
                                        <li *ngFor="let item of summaryJson.AdditionalInformation" class="dot">
                                            <p class="mb-0"><strong>{{item.date | date}} - {{ ('steps.' + item.type) |
                                                    translate }}</strong></p>
                                            <p>{{item.event}}</p>
                                        </li>
                                    </ul>
                                </ng-container>
                                <ng-template #noObservations>
                                    <span class="ml-2">{{'summary.No observations' | translate }}</span>
                                </ng-template>
                            </ng-template>
                        </ng-container>
                    </div>
                    <p class="text-muted pt-3 mb-0">{{'generics.generated by artificial intelligence' | translate }}</p>
                </div>
                <div *ngIf="summaryJson && summaryJson.data" class="summary-content">
                    <div [innerHTML]="summaryJson.data | safe: 'html'"></div>
                </div>
                <div *ngIf="!summaryJson">
                    <p>{{'home.placeholderError' | translate }}</p>
                </div>
            </div>
        </div>
    </div>
    <div class="modal-footer" id="idFooter" *ngIf="needFeedback">
        <app-feedback-summary-page [documents]="docs" [type]="'general'" (close)="handleClose()">
        </app-feedback-summary-page>
        <!--<button type="button" class="btn btn-dark" (click)="openFeedback('general');">{{'feedback.Give us your opinion on the summary' | translate }}</button>-->
    </div>
</ng-template>

<ng-template #contentviewProposedEvents let-c="close" let-d="dismiss" appendTo="body">
    <div class="modal-header" id="idHeader">
        <div class="content-header text-left">
            <h4 class="mb-0">{{'events.title' | translate }}</h4>
        </div>
        <button type="button" class="close" aria-label="Close" (click)="closeModal();">
            <span aria-hidden="true">&times;</span>
        </button>
    </div>
    <div class="modal-body content-wrapper p-2" id="idBody">
        <div class="p-1">
            <form action="#" class="form form-horizontal" [formGroup]="eventsForm">
                <div class="form-body">
                    <div class="">
                        <div class="">
                            <div class="form-group">
                                <label>{{'generics.Name' | translate }}</label>
                                <input type="text" class="col-12 form-control" id="numericos2" formControlName="name"
                                    [ngClass]="{ 'is-invalid': submitted && ef.name.errors }" name="numericos2">
                                <small class="form-text text-muted danger"
                                    *ngIf="submitted && ef.name.errors">{{'generics.required' |
                                    translate }}</small>
                            </div>
                        </div>
                        <div class="">
                            <div class="form-group">
                                <label class="mb-0">{{'generics.Date' | translate }}</label>
                                <div class="">
                                    <mat-form-field class="mr-sm-24" fxFlex>
                                        <input matInput class="grey" readonly [matDatepicker]="picker"
                                            autocomplete="off" name="date" formControlName="date">
                                        <button *ngIf="eventsForm.value.endDate!=null" matSuffix mat-icon-button
                                            aria-label="Clear" (click)="eventsForm.controls['endDate'].setValue(null)"
                                            style="position: absolute; left: 30px;">
                                            <em class="fa fa-trash danger"></em>
                                        </button>
                                        <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
                                        <mat-datepicker touchUi="true" [startAt]="date" #picker></mat-datepicker>
                                    </mat-form-field>
                                </div>
                            </div>
                        </div>

                        <div>
                            <div class="form-group">
                                <label for="key">{{ 'events.Type' | translate }}</label>
                                <select class="form-control" id="key" formControlName="key">
                                    <option value="">{{ 'timeline.Select type' | translate }}</option>
                                    <option value="diagnosis">🩺 {{ 'timeline.Diagnoses' | translate }}</option>
                                    <option value="treatment">💉 {{ 'timeline.Treatment' | translate }}</option>
                                    <option value="test">🔬 {{ 'timeline.Tests' | translate }}</option>
                                    <option value="appointment">📅 {{ 'events.appointment' | translate }}</option>
                                    <option value="symptom">🤒 {{ 'timeline.Symptoms' | translate }}</option>
                                    <option value="medication">💊 {{ 'timeline.Medications' | translate }}</option>
                                    <option value="other">🔍 {{ 'timeline.Other' | translate }}</option>
                                </select>
                            </div>
                        </div>
                        <div class="">
                            <div class="form-group">
                                <label>{{'generics.notes' | translate }}</label>
                                <textarea maxlength="150" name="notes" formControlName="notes"
                                    placeholder="{{'generics.Write down any details' | translate }}"
                                    class="autoajustable form-control"></textarea>
                            </div>
                        </div>
                    </div>

                </div>
            </form>
            <div class="col-md-12 center-elements" *ngIf="!submitted">
                <button type="button" class="btn btn-secondary mr-1" (click)="cancelData();">{{'generics.Cancel' |
                    translate }}</button>
                <button type="button" class="btn btn-dark ml-1" (click)="saveData(true, true);">{{'generics.Save' |
                    translate }}</button>
            </div>
            <div class="col-md-12 center-elements" *ngIf="submitted">
                <em class="fa fa-spinner fa-spin fa-2x fa-fw primary"></em>
            </div>
        </div>
    </div>
</ng-template>

<ng-template #contentviewProposedAppointments let-c="close" let-d="dismiss" appendTo="body">
    <div class="modal-header" id="idHeader">
        <div class="content-header text-left">
            <h4 class="mb-0">{{'events.appointment' | translate }}</h4>
        </div>
        <button type="button" class="close" aria-label="Close" (click)="closeModal();">
            <span aria-hidden="true">&times;</span>
        </button>
    </div>
    <div class="modal-body content-wrapper p-2" id="idBody">
        <div class="p-1">
            <form action="#" class="form form-horizontal" [formGroup]="appointmentsForm">
                <div class="form-body">
                    <div class="">
                        <div class="">
                            <div class="form-group">
                                <label>{{'generics.Name' | translate }}</label>
                                <input type="text" class="col-12 form-control" id="numericos2" formControlName="name"
                                    [ngClass]="{ 'is-invalid': submitted && efappointment.name.errors }"
                                    name="numericos2">
                                <small class="form-text text-muted danger"
                                    *ngIf="submitted && efappointment.name.errors">{{'generics.required' |
                                    translate }}</small>
                            </div>
                        </div>
                        <div class="">
                            <div class="form-group">
                                <label class="mb-0">{{'generics.Date' | translate }}</label>
                                <div class="">
                                    <mat-form-field class="mr-sm-24" fxFlex>
                                        <input matInput class="grey" readonly [matDatepicker]="picker"
                                            autocomplete="off" name="date" formControlName="date">
                                        <button *ngIf="appointmentsForm.value.endDate!=null" matSuffix mat-icon-button
                                            aria-label="Clear"
                                            (click)="appointmentsForm.controls['endDate'].setValue(null)"
                                            style="position: absolute; left: 30px;">
                                            <em class="fa fa-trash danger"></em>
                                        </button>
                                        <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
                                        <mat-datepicker touchUi="true" [startAt]="dateAppointment"
                                            #picker></mat-datepicker>
                                    </mat-form-field>
                                </div>
                            </div>
                        </div>
                        <div class="">
                            <div class="form-group">
                                <label>{{'generics.notes' | translate }}</label>
                                <textarea maxlength="150" name="notes" formControlName="notes"
                                    placeholder="{{'generics.Write down any details' | translate }}"
                                    class="autoajustable form-control"></textarea>
                            </div>
                        </div>
                    </div>

                </div>
            </form>
            <div class="col-md-12 center-elements" *ngIf="!submitted">
                <button type="button" class="btn btn-secondary mr-1" (click)="cancelData();">{{'generics.Cancel' |
                    translate }}</button>
                <button type="button" class="btn btn-dark ml-1"
                    (click)="saveAppointmentsData(true, true);">{{'generics.Save' |
                    translate }}</button>
            </div>
            <div class="col-md-12 center-elements" *ngIf="submitted">
                <em class="fa fa-spinner fa-spin fa-2x fa-fw primary"></em>
            </div>
        </div>
    </div>
</ng-template>

<ng-template #shareCustom let-c="close" let-d="dismiss" appendTo="body">
    <app-share-modal [shareTemplate]="contentshareCustom" [mode]="mode"
        (closeModal)="closeModalShare()"></app-share-modal>
</ng-template>

<ng-template #ContentOptionsMenu let-c="close" let-d="dismiss" appendTo="body">
    <div class="modal-header" id="idHeader">
        <button type="button" class="close" aria-label="Close" (click)="closeModal();">
            <span aria-hidden="true">&times;</span>
        </button>
    </div>
    <div class="modal-body card mb-0">
        <div class="row">
            <div class="col-md-12 center-elements">
                <div class="col-md-12 mb-2 mt-3">
                    <p>{{'optionsMenu.t1' | translate }}</p>
                    <p>{{'optionsMenu.t2' | translate }} <em class="primary" style="cursor: pointer;"
                            placement="end-start" #p1="ngbPopover" [ngbPopover]="popContenthelp"
                            popoverTitle="{{'topnavbar.Help' | translate }}">{{'optionsMenu.t3' | translate }}</em>
                        {{'optionsMenu.t4' | translate }}</p>
                    <ng-template #popContenthelp>
                        <span [innerHTML]="welcomeMsg | safe: 'html'">
                        </span>
                        <button class="pull-right mt-2" style="margin-top: 1em;margin-bottom: 1em;"
                            (click)="p1.close()">{{'generics.Close' |translate }}</button>
                    </ng-template>
                </div>
                <div class="col-md-12 mb-2 mt-2 d-block" *ngIf="actualCategory == null">
                    <div class="border bg-grey bg-lighten-3 p-3">
                        <a class="mr-1" [ngClass]="(showOptionsData=='general')?'text-bold-700 border-custom':''"
                            (click)="changeOptionData('general')">{{'optionsMenu.t5' | translate }}</a>
                        <a class="ml-1 mr-1"
                            [ngClass]="(showOptionsData=='categoriesPatients')?'text-bold-700 border-custom':''"
                            (click)="changeOptionData('categoriesPatients')">{{'categoriesPatients.title' | translate
                            }}</a>
                        <a class="ml-1 mr-1"
                            [ngClass]="(showOptionsData=='categoriesCaregivers')?'text-bold-700 border-custom':''"
                            (click)="changeOptionData('categoriesCaregivers')">{{'categoriesCaregivers.title' |
                            translate }}</a>
                        <a class="ml-1"
                            [ngClass]="(showOptionsData == 'summaryTypes') ? 'text-bold-700 border-custom' : ''"
                            (click)="changeOptionData('summaryTypes')">{{'summaryoptions.title' | translate }}</a>
                    </div>
                </div>

                <!--<div class="col-md-12 mb-2 mt-2 d-block d-sm-none" *ngIf="actualCategory == null">
                <select (change)="changeOptionData($event.target.value)">
                    <option value="general">{{'optionsMenu.t5' | translate }}</option>
                    <option value="categoriesPatients">{{'categoriesPatients.title' | translate }}</option>
                    <option value="categoriesCaregivers">{{'categoriesCaregivers.title' | translate }}</option>
                </select>
            </div>-->
                <div *ngIf="showOptionsData=='general'" class="col-md-12">
                    <div class="row">
                        <div class="col-md-4">
                            <div class="card card-body card-custom d-flex justify-content-center align-items-center pointer"
                                (click)="selectCustomSuggestion('optionsMenu.q1')">
                                {{'optionsMenu.q1' | translate }}
                            </div>

                        </div>
                        <div class="col-md-4">
                            <div class="card card-body card-custom d-flex justify-content-center align-items-center pointer"
                                (click)="selectCustomSuggestion('optionsMenu.q2')">
                                {{'optionsMenu.q2' | translate }}
                            </div>

                        </div>
                        <div class="col-md-4">
                            <div class="card card-body card-custom d-flex justify-content-center align-items-center pointer"
                                (click)="selectCustomSuggestion('optionsMenu.q3')">
                                {{'optionsMenu.q3' | translate }}
                            </div>

                        </div>
                        <div class="col-md-4">
                            <div class="card card-body card-custom d-flex justify-content-center align-items-center pointer"
                                (click)="selectCustomSuggestion('optionsMenu.q4')">
                                {{'optionsMenu.q4' | translate }}
                            </div>

                        </div>
                        <div class="col-md-4">
                            <div class="card card-body card-custom d-flex justify-content-center align-items-center">

                                <li class="d-inline-block" ngbDropdown display="dynamic" container="body">
                                    <a class="position-relative colorlink" id="dropdownLang" ngbDropdownToggle
                                        role="button">
                                        <u>{{'optionsMenu.q5' | translate }}</u>
                                    </a>
                                    <div ngbDropdownMenu aria-labelledby="dropdownLang" class="dropdownLang">
                                        <a class="dropdown-item py-1 lang" href="javascript:;"
                                            (click)="selectCustomSuggestion('optionsMenu.q5.1')">
                                            <span>{{'optionsMenu.q5.1' | translate }}</span>
                                        </a>
                                        <a class="dropdown-item py-1 lang" href="javascript:;"
                                            (click)="selectCustomSuggestion('optionsMenu.q5.2')">
                                            <span>{{'optionsMenu.q5.2' | translate }}</span>
                                        </a>
                                        <a class="dropdown-item py-1 lang" href="javascript:;"
                                            (click)="selectCustomSuggestion('optionsMenu.q5.3')">
                                            <span>{{'optionsMenu.q5.3' | translate }}</span>
                                        </a>
                                        <a class="dropdown-item py-1 lang" href="javascript:;"
                                            (click)="selectCustomSuggestion('optionsMenu.q5.4')">
                                            <span>{{'optionsMenu.q5.4' | translate }}</span>
                                        </a>
                                        <a class="dropdown-item py-1 lang" href="javascript:;"
                                            (click)="selectCustomSuggestion('optionsMenu.q5.5')">
                                            <span>{{'optionsMenu.q5.5' | translate }}</span>
                                        </a>
                                        <a class="dropdown-item py-1 lang" href="javascript:;"
                                            (click)="selectCustomSuggestion('optionsMenu.q5.6')">
                                            <span>{{'optionsMenu.q5.6' | translate }}</span>
                                        </a>
                                        <a class="dropdown-item py-1 lang" href="javascript:;"
                                            (click)="selectCustomSuggestion('optionsMenu.q5.7')">
                                            <span>{{'optionsMenu.q5.7' | translate }}</span>
                                        </a>
                                        <a class="dropdown-item py-1 lang" href="javascript:;"
                                            (click)="selectCustomSuggestion('optionsMenu.q5.8')">
                                            <span>{{'optionsMenu.q5.8' | translate }}</span>
                                        </a>
                                        <a class="dropdown-item py-1 lang" href="javascript:;"
                                            (click)="selectCustomSuggestion('optionsMenu.q5.9')">
                                            <span>{{'optionsMenu.q5.9' | translate }}</span>
                                        </a>
                                    </div>
                                </li>
                            </div>

                        </div>
                        <div class="col-md-4">
                            <div class="card card-body card-custom d-flex justify-content-center align-items-center pointer"
                                (click)="selectCustomSuggestion('optionsMenu.q6')">
                                {{'optionsMenu.q6' | translate }}
                            </div>

                        </div>
                        <p class="text-muted small mt-2">
                            <em>{{'optionsMenu.hint' | translate }}</em>
                        </p>
                    </div>

                </div>
                <div *ngIf="showOptionsData == 'summaryTypes'" class="col-md-12">
                    <div class="col-md-12">
                        <div class="row">
                            <div class="col-md-6" *ngFor="let summaryType of summaryTypes">
                                <div class="card card-body card-custom d-flex justify-content-center align-items-center pointer"
                                    (click)="selectSummaryType(summaryType.description)">
                                    <h5>{{summaryType.title | translate}}</h5>
                                    <p>{{summaryType.description | translate}}</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div *ngIf="showOptionsData!='general' && showOptionsData!='summaryTypes'" class="col-md-12">
                    <div *ngIf="actualCategory==null" class="row">
                        <p class="col-md-12 mb-0 mt-2 black text-bold-700">{{'generics.Select a category' | translate
                            }}:</p>
                        <span *ngIf="showOptionsData=='categoriesPatients'" class="col-md-12">
                            <div class="row">
                                <div *ngFor="let categorie of categoriesPatients" class="col-md-4">
                                    <div class="card card-body border card-categorie d-flex justify-content-center align-items-center pointer"
                                        (click)="selectCategorie(categorie)">
                                        <img class="logo-img-big" style="width: 60px;" [src]="categorie.icon" />
                                        <u>{{categorie.title}} </u>
                                    </div>
                                </div>
                            </div>
                        </span>
                        <span *ngIf="showOptionsData=='categoriesCaregivers'" class="col-md-12">
                            <div class="row">
                                <div *ngFor="let categorie of categoriesCaregivers" class="col-md-4">
                                    <div class="card card-body border card-categorie d-flex justify-content-center align-items-center pointer"
                                        (click)="selectCategorie(categorie)">
                                        <img class="logo-img-big" style="width: 60px;" [src]="categorie.icon" />
                                        <u>{{categorie.title}} </u>
                                    </div>
                                </div>
                            </div>
                        </span>
                    </div>
                    <div *ngIf="actualCategory != null" class="row">
                        <div class="col-md-12 center-elements">
                            <!-- Botón para regresar o seleccionar otra categoría -->
                            <button class="btn btn-dark" (click)="actualCategory = null"><em
                                    class="fa fa-arrow-up"></em> {{'generics.Back to categories' | translate }}</button>
                            <!-- Icono y nombre de la categoría seleccionada -->
                            <div class="category-header mt-4">
                                <img class="logo-img-small" style="width: 30px; height: 30px;"
                                    src="{{actualCategory.icon}}" />
                                <span class="text-bold-700">{{actualCategory.title}}</span>
                            </div>
                        </div>
                        <div class="col-md-12">
                            <div class="row">
                                <div *ngFor="let suggestion of actualCategory.questions" class="col-md-4">
                                    <div class="card card-body card-custom d-flex justify-content-center align-items-center pointer"
                                        (click)="selectSuggestion(suggestion)">
                                        {{suggestion}}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>


                </div>
                <p class="mt-2" *ngIf="docs.length==0" [innerHTML]="'optionsMenu.t7' | translate"></p>
            </div>
        </div>

    </div>
</ng-template>
<ng-template #contentPhoto let-c="close" let-d="dismiss" appendTo="body">
    <div class="modal-header" id="idHeader">
        <button type="button" class="close" aria-label="Close" (click)="closeModal();">
            <span aria-hidden="true">&times;</span>
        </button>
    </div>
    <div class="modal-body">
        <div class="row text-left">
            <div class="card-body col-md-12">
                <div class="row">
                    <div class="col-sm-12" *ngIf="stepPhoto==1">
                        <video #videoElement id="videoElement" class="w-100" autoplay></video>
                    </div>
                    <div class="col-sm-12" *ngIf="stepPhoto==2">
                        <div class="mb-3">
                            <label for="nameFileCamera" class=""><strong>{{'demo.Document name' | translate
                                    }}</strong></label>
                            <input type="text" class="mt-0 form-control" [(ngModel)]="nameFileCamera"
                                placeholder="{{'demo.Document name' | translate }}">
                        </div>
                        <img *ngIf="capturedImage" class="w-100" [src]="capturedImage" />
                        <div class="center-elements">
                            <button type="button" class="mt-2 btn btn-dark" (click)="prevCamera();">{{'demo.Repeat
                                photo' | translate }}</button>
                        </div>

                    </div>
                </div>
            </div>
        </div>
        <div *ngIf="tempDocs.length>0">
            <strong>{{'demo.Photos taken' | translate }}:</strong>
            <p *ngFor="let doc of tempDocs; let i = index" class="mb-0">
                <span>{{doc.dataFile.name}} <em class="ml-1 danger fa fa-trash pointer"
                        (click)="deletephoto(i)"></em></span>
            </p>
        </div>
    </div>
    <div class="modal-footer">
        <div class="form-actions col-md-12 center-elements">
            <button type="button" *ngIf="stepPhoto==1" class="btn btn-dark float-right"
                (click)="captureImage()">{{'demo.Capture photo' | translate }}</button>
            <button type="button" *ngIf="stepPhoto==2 && tempDocs.length<5" class="btn btn-dark float-left"
                (click)="otherPhoto(true)">{{'demo.Add another photo' | translate }}</button>
            <button type="button" *ngIf="stepPhoto==2" class="btn btn-dark float-right"
                (click)="otherPhoto(false)">{{'generics.Finish' | translate }}</button>
        </div>
    </div>
</ng-template>
<ng-template #contentviewSelectFile let-c="close" let-d="dismiss" appendTo="body">
    <div class="modal-header" id="idHeader">
        <div class="content-header text-left">
            <h4 class="mb-0">{{'demo.Add new document' | translate }}</h4>
        </div>
        <button type="button" class="close" aria-label="Close" (click)="closeModal();">
            <span aria-hidden="true">&times;</span>
        </button>
    </div>
    <div class="modal-body content-wrapper p-2" id="idBody">
        <div class="p-1">
            <div class="form-body">
                <div class="center-elements pb-2 col-12" href="javascript:void(0)">
                    <div class="row">
                        <div class="col-md-4 mb-2" *ngIf="showCameraButton">
                            <div class="col-md-12">
                                <i class="fa fa-camera dark fa-3x pointer" aria-hidden="true"
                                    (click)="entryOpt('opt1', contentPhoto)"></i>
                            </div>
                            <div><button class="btnblock btn btn-dark mt-2"
                                    (click)="entryOpt('opt1', contentPhoto)">{{'demo.Take a photo' | translate
                                    }}</button></div>
                        </div>
                        <div [ngClass]="{'col-md-4 mb-2': showCameraButton, 'col-6 mb-2': !showCameraButton}">
                            <div class="col-md-12">
                                <i class="fa fa-upload dark fa-3x pointer" aria-hidden="true"></i>
                                <!--<img class="logo-img" [src]="icons[4].data" />-->
                            </div>
                            <input *ngIf="!isMobile" type="file" #fileDropRef id="fileDropRef" multiple
                                style="display: none;" (change)="onFileChangeStep($event);"
                                accept=".pdf, .docx, .jpg, .png, .jpeg, .txt" />
                            <input *ngIf="isMobile" type="file" #fileDropRef id="fileDropRef" multiple
                                style="display: none;" (change)="onFileChangeStep($event);" />
                            <label class="mb-1 mt-2 btn btn-dark mb-0"
                                style="text-transform: none;letter-spacing: 0px;cursor: pointer;"
                                for="fileDropRef">{{'generics.Upload' | translate }}
                            </label>
                            <span class="text-muted small d-block">{{'demo.Max. 5 documents' | translate }}</span>
                        </div>
                        <div [ngClass]="{'col-md-4 mb-2': showCameraButton, 'col-6 mb-2': !showCameraButton}">
                            <div class="col-md-12">
                                <i class="fa-solid fa-paste dark fa-3x pointer" aria-hidden="true"
                                    (click)="entryOpt('opt2', contentManual)"></i>
                            </div>
                            <div><button class="btnblock btn btn-dark mt-2"
                                    (click)="entryOpt('opt2', contentManual)">{{'demo.Write text' | translate
                                    }}</button></div>
                        </div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</ng-template>
<ng-template #contentManual id="contentManual" let-c="close" let-d="dismiss" appendTo="body">
    <div class="modal-header" id="idHeader">
        <div class="content-header text-left">
            <h4 class="mb-0">{{'demo.Create report' | translate }}</h4>
        </div>
        <button type="button" class="close" aria-label="Close" (click)="closeModal();">
            <span aria-hidden="true">&times;</span>
        </button>
    </div>
    <div class="modal-body content-wrapper p-2" id="idBody">
        <div class="p-1">
            <div>
                <!--<div class="voice-recorder" *ngIf="supported" style="margin-bottom: 20px;">
                    <div class="card-body border round p-3 mic-icon pointer bg-white" (click)="toggleRecording()">
                      <span *ngIf="!recording" class="d-block">{{'voice.Start Voice Recognition' | translate }}</span>
                      <i class="mt-2 fa-2x fa fa-microphone" *ngIf="!recording"></i>
                      <span *ngIf="recording" class="d-block">{{'voice.Stop Voice Recognition' | translate }}</span>
                      <i class="mt-2 fa-2x fa fa-stop danger" *ngIf="recording"></i>
                      <div *ngIf="recording" class="d-block recording-indicator">
                        <i class="fa fa-circle record-icon"></i> {{'voice.Recording' | translate }}...
                      </div>
                      <div *ngIf="recording" class="d-block">
                        <p>{{ timerDisplay }}</p>
                      </div>
                    </div>
                    
                  </div>-->
                <div class="row">
                    <div class="col-md-12 center-elements">
                        <div class="d-flex align-items-center mb-3">
                            <input type="text" class="form-control mt-0 mr-2" [(ngModel)]="tempFileName"
                                placeholder="{{'voice.Enter file name' | translate }}" />

                            <!-- Voice recorder button -->
                            <button *ngIf="supported" class="btn btn-outline-primary d-flex align-items-center"
                                (click)="toggleRecording()" [ngClass]="{'btn-danger': recording}"
                                title="{{recording ? 'voice.Stop Voice Recognition' : 'voice.Start Voice Recognition' | translate}}">
                                <i class="fa" [ngClass]="recording ? 'fa-stop' : 'fa-microphone'"></i>
                                <span *ngIf="recording" class="ml-2">{{ timerDisplay }}</span>
                            </button>
                        </div>

                        <textarea #inputTextArea class="form-control data-hj-allow" style="height:320px;"
                            [(ngModel)]="medicalText" name="medicalText"
                            placeholder="{{'generics.Create-paste a report' | translate }}"></textarea>

                        <button type="button" class="mt-2 btn btn-sm btn-dark"
                            [disabled]="callingSummary || recording || medicalText.length==0"
                            title="{{'generics.Save' | translate }}" (click)="createFile();">
                            <span>{{'generics.Save' | translate }}</span>
                        </button>
                    </div>
                </div>


            </div>
        </div>
    </div>
</ng-template>
<ng-template #PanelChangeDate let-c="close" let-d="dismiss" appendTo="body">
    <div class="modal-header" id="idHeader">
        <div class="content-header text-left">
            <h4 class="mb-0">{{'dashboardpatient.Update document date' | translate }}</h4>
        </div>
        <button type="button" class="close" aria-label="Close" (click)="closeModal2();">
            <span aria-hidden="true">&times;</span>
        </button>
    </div>
    <div class="modal-body content-wrapper p-2" id="idBody">
        <div class="p-1">
            <div class="form-body">
                <div class="center-elements pb-2 col-12" href="javascript:void(0)">
                    <mat-form-field appearance="fill">
                        <mat-label>{{'generics.Date' | translate }}</mat-label>
                        <input matInput [matDatepicker]="picker" readonly [(ngModel)]="tempDoc.originaldate"
                            (click)="picker.open()">
                        <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
                        <mat-datepicker touchUi="true" #picker></mat-datepicker>
                    </mat-form-field>

                </div>
            </div>
        </div>
    </div>
    <div class="modal-footer">
        <div class="form-actions col-md-12 center-elements">
            <button type="button" class="btn btn-secondary mr-1" (click)="closeModal2();">{{'generics.Cancel' |
                translate }}</button>
            <button type="button" class="btn btn-dark ml-1" (click)="updateDocDate();">{{'dashboardpatient.confirm' |
                translate }}</button>
        </div>
    </div>
</ng-template>
<ng-template #addNoteModal let-modal>
    <div class="modal-header">
        <h4 class="modal-title">{{'notes.Add Note' | translate}}</h4>
        <button type="button" class="close" aria-label="Close" (click)="cancelEdit()">
            <span aria-hidden="true">&times;</span>
        </button>
    </div>
    <div class="modal-body">
        <form>
            <div class="form-group">
                <label for="noteContent">{{'notes.Note Content' | translate}}</label>
                <textarea class="form-control" id="noteContent" rows="5" [(ngModel)]="newNoteContent"
                    name="noteContent"></textarea>
            </div>
        </form>
    </div>
    <div class="modal-footer">
        <button type="button" class="btn btn-secondary" (click)="cancelEdit()">{{'generics.Cancel' |
            translate}}</button>
        <button type="button" class="btn btn-dark" (click)="saveNote()">{{'generics.Save' | translate}}</button>
    </div>
</ng-template>